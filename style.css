/* ========================================
    기본 설정 (Patch v3.7 - 안정화 버전)
======================================== */
:root {
    --primary: #6c5ce7;
    --bg: #f0f2f5;
    --card: #ffffff;
    --nav-height: 60px;
}

body {
    font-family: 'Pretendard', -apple-system, sans-serif;
    background-color: var(--bg);
    margin: 0;
    padding: 0;
    display: flex;
    justify-content: center;
    
    /* 100dvh와 fixed를 동시에 써서 화면을 꽉 채웁니다 */
    position: fixed;
    width: 100%;
    height: 100%;
    height: 100dvh;
    overflow: hidden;
}

.app-container {
    width: 100%;
    max-width: 420px;
    background: var(--card);
    height: 100%;
    
    display: flex;
    flex-direction: column;
    position: relative;
    box-shadow: 0 0 20px rgba(0,0,0,0.1);
}

/* ========================================
    DB 상태 표시
======================================== */
.db-status {
    position: absolute;
    top: 10px;
    right: 10px;
    font-size: 10px;
    font-weight: bold;
    background: #e6fffa;
    border: 1px solid #00b894;
    color: #00b894;
    padding: 2px 6px;
    border-radius: 8px;
    display: none;
    z-index: 1000;
}
.db-status.on { display: block; }

/* ========================================
    화면 (Screen) - 스크롤 영역
======================================== */
.screen {
    display: none;
    flex-direction: column;
    
    /* 남은 공간 다 쓰기 */
    flex: 1;
    width: 100%;
    
    padding: 15px;
    
    /* [핵심] 하단바 높이(60) + 여유(40) + 노치(env) = 넉넉하게! */
    /* !important를 붙여서 다른 설정보다 무조건 우선시합니다 */
    padding-bottom: calc(100px + env(safe-area-inset-bottom)) !important;
    
    box-sizing: border-box;
    overflow-y: auto;
    overflow-x: hidden;
    
    /* 모바일 터치감 개선 */
    -webkit-overflow-scrolling: touch; 
}

.screen.active { 
    display: flex; 
}

/* ========================================
    하단 네비게이션 (Bottom Nav) - 다시 Fixed로 복귀
======================================== */
.bottom-nav {
	/* [핵심] 다시 Fixed로 화면 맨 밑에 붙이고 */
    position: fixed !important;
    bottom: 0;
    left: 0;
    right: 0;
    margin: 0 auto;
    max-width: 420px;
    
    width: 100%;
    height: var(--nav-height);
    
    /* 배경을 확실하게 칠해서 뒤에 글자가 안 비치게 합니다 */
    background: rgba(255, 255, 255, 0.98); 
    border-top: 1px solid #eee;
    
    display: none;
    justify-content: space-around;
    align-items: center;
	/* Z-Index는 50으로 유지 */
    z-index: 50; /* 메뉴바는 팝업보다 낮게 */
    
    /* 높이 보정 */
    padding-bottom: env(safe-area-inset-bottom);
    height: calc(var(--nav-height) + env(safe-area-inset-bottom));
}

.app-container.logged-in .bottom-nav { 
    display: flex !important; 
}

/* 네비게이션 아이템 */
.nav-item {
    flex: 1;
    text-align: center;
    font-size: 11px;
    color: #b2bec3;
    cursor: pointer;
    padding: 5px 0;
    
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    height: var(--nav-height); /* 높이 고정 */
    
    /* PC 커서 */
    cursor: pointer !important;
    user-select: none;
    -webkit-user-select: none;
}

.nav-item.active {
    color: var(--primary);
    font-weight: 800;
}

/* 아이콘 */
.nav-icon {
    font-size: 24px !important;
    display: block;
    margin-bottom: 2px;
    transition: transform 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55) !important;
}

.nav-item:active .nav-icon {
    transform: scale(1.4) !important;
}

/* ========================================
    기타 컴포넌트 (기존 유지)
======================================== */
h1, h2, h3 { color: #2d3436; margin: 0 0 15px 0; text-align: center; }
p { color: #636e72; font-size: 15px; margin-bottom: 25px; text-align: center; }

.btn { width: 100%; padding: 15px; border: none; border-radius: 12px; font-size: 16px; font-weight: 700; cursor: pointer; margin-bottom: 10px; transition: 0.1s; }
.btn:active { transform: scale(0.98); }
.btn-kakao { background-color: #FEE500; color: #191919; }
.btn-primary { background-color: var(--primary); color: white; }
.btn-outline { background: white; border: 2px solid #dfe6e9; color: #636e72; }

.mbti-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; margin-bottom: 15px; }
.mbti-btn { padding: 10px 0; font-size: 13px; font-weight: bold; border: 1px solid #dfe6e9; border-radius: 8px; background: white; cursor: pointer; color: #636e72; }
.mbti-btn:active { background: var(--primary); color: white; border-color: var(--primary); }

.header-area { text-align: center; margin-bottom: 10px; }
.header-title { font-size: 22px; font-weight: 800; color: #2d3436; margin: 0; }
.header-badge { display: inline-block; background: #eee; padding: 4px 12px; border-radius: 20px; font-size: 12px; font-weight: bold; color: #636e72; margin-top: 5px; }

.avatar-area { display: flex; justify-content: center; margin-bottom: 15px; }
.avatar-circle { width: 80px; height: 80px; background: #fff0f6; border-radius: 50%; display: flex; justify-content: center; align-items: center; font-size: 40px; border: 3px solid white; box-shadow: 0 4px 10px rgba(0,0,0,0.1); position: relative; }
.avatar-badge { position: absolute; bottom: 0; right: 0; background: var(--primary); color: white; font-size: 10px; padding: 3px 8px; border-radius: 10px; font-weight: bold; }

.msg-bubble { background: #f1f2f6; padding: 8px 16px; border-radius: 20px; margin-top: 10px; font-size: 13px; color: #636e72; position: relative; max-width: 80%; text-align: center; }
.msg-bubble::after { content: ''; position: absolute; top: -6px; left: 50%; transform: translateX(-50%); border-width: 0 6px 8px; border-style: solid; border-color: #f1f2f6 transparent; display: block; width: 0; }

.sub-tab-bar { display: flex; margin-bottom: 20px; background: #f1f2f6; border-radius: 12px; padding: 4px; }
.sub-tab { flex: 1; text-align: center; padding: 8px 0; font-size: 14px; color: #636e72; border-radius: 10px; cursor: pointer; transition: 0.2s; font-weight: 500; }
.sub-tab.active { background: white; color: var(--primary); font-weight: bold; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }

.sub-content { display: none; animation: fadeIn 0.3s ease; }
.sub-content.active { display: block; }
@keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

/* 차트 복구 */
.chart-wrapper { width: 100%; height: 280px; position: relative; margin-bottom: 10px; display: flex; justify-content: center; align-items: center; }

/* 업적 (Patch v2.12 CSS 추가) */
.achieve-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr); 
    gap: 10px; 
    padding: 10px 0;
}

.achieve-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding-top: 10px; 
    padding-bottom: 10px;
    position: relative;
    overflow: hidden;
    background: var(--card);
    border: 1px solid #eee;
    border-radius: 12px;
    cursor: pointer;
    transition: 0.2s;
}

.achieve-item:active {
    transform: scale(0.98);
}

.achieve-icon {
    font-size: 28px;
    margin-bottom: 5px;
    display: block;
}

.achieve-title {
    font-size: 10px;
    font-weight: 600;
    color: #636e72;
    text-align: center;
    word-break: keep-all;
}

.achieve-item.locked {
    opacity: 0.5;
}

/* 토너먼트 */
.vote-wrapper { flex: 1; display: flex; flex-direction: column; justify-content: center; width: 100%; padding: 10px 0; }
.ticket-badge { font-size: 13px; font-weight: bold; color: #6c5ce7; background: #f0f3ff; padding: 5px 12px; border-radius: 20px; display: inline-block; margin-bottom: 5px; }
.round-badge { background: #2d3436; color: white; padding: 5px 15px; border-radius: 20px; font-size: 14px; font-weight: bold; display: inline-block; margin-bottom: 15px; }
#voteTitle { font-size: 20px; word-break: keep-all; line-height: 1.4; margin: 0 0 40px 0; }
.vs-container { display: flex; flex-direction: row; align-items: center; justify-content: center; gap: 10px; width: 100%; position: relative; }
.vs-card { flex: 1; height: 240px; padding: 15px 5px; border: 2px solid #dfe6e9; border-radius: 20px; text-align: center; cursor: pointer; display: flex; flex-direction: column; align-items: center; justify-content: center; transition: all 0.2s cubic-bezier(0.25, 0.8, 0.25, 1); background: white; box-shadow: 0 4px 6px rgba(0,0,0,0.05); }
.vs-card:active { border-color: var(--primary); background-color: #f0f3ff; transform: scale(0.96); }
.vs-avatar { width: 80px; height: 80px; background: #f1f2f6; border-radius: 50%; display: flex; justify-content: center; align-items: center; font-size: 40px; margin-bottom: 10px; box-shadow: inset 0 0 10px rgba(0,0,0,0.05); }
.vs-text-area { width: 100%; padding: 0 5px; box-sizing: border-box; }
.vs-name { font-size: 18px; font-weight: 800; margin-bottom: 5px; color: #2d3436; }
.vs-desc { font-size: 12px; color: #636e72; font-weight: 600; line-height: 1.3; word-break: keep-all; opacity: 0.8; }
.vs-divider-text { font-size: 28px; font-weight: 900; font-style: italic; color: #dfe6e9; text-shadow: 1px 1px 0px #fff; z-index: 10; margin: 0 2px; flex-shrink: 0; align-self: center; }

/* 랭킹 */
.rank-header-area { margin-bottom: 15px; }
.rank-filter-row { display: flex; align-items: center; width: 100%; }
.stat-pills { flex: 1; display: flex; gap: 3px; overflow-x: auto; scrollbar-width: none; -ms-overflow-style: none; padding-bottom: 2px; }
.stat-pills::-webkit-scrollbar { display: none; }
.stat-pill { white-space: nowrap; padding: 6px 7px; border-radius: 12px; background: #f1f2f6; color: #636e72; font-size: 10.5px; font-weight: 600; cursor: pointer; border: 1px solid transparent; transition: 0.2s; flex-shrink: 1; }
.stat-pill.active { background: white; border-color: var(--primary); color: var(--primary); box-shadow: 0 2px 4px rgba(108, 92, 231, 0.15); font-weight: 700; }
.list-wrap { list-style: none; padding: 0; margin: 0; }
.list-item { display: flex; align-items: center; padding: 15px 0; border-bottom: 1px solid #eee; width: 100%; box-sizing: border-box; }
.list-item > div:first-child { text-align: center; margin-right: 10px; font-weight: 900; }
.list-item > div:last-child { text-align: right; white-space: nowrap; }

/* 상점 & 설정 */
.shop-section { margin-bottom: 30px; }
.shop-title { font-size: 16px; font-weight: bold; color: #2d3436; margin-bottom: 10px; border-left: 4px solid var(--primary); padding-left: 10px; }
.shop-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
.shop-item { background: white; border: 1px solid #eee; border-radius: 12px; padding: 15px; text-align: center; cursor: pointer; }
.shop-item:active { transform: scale(0.98); }
.shop-item-img { font-size: 30px; margin-bottom: 5px; }
.shop-item-name { font-size: 14px; font-weight: bold; margin-bottom: 5px; }
.shop-item-price { font-size: 12px; color: var(--primary); font-weight: bold; }
.cash-price { color: #00b894; }

.settings-profile { display: flex; align-items: center; margin-bottom: 20px; padding-bottom: 20px; border-bottom: 1px solid #f1f2f6; }
.st-avatar { width: 60px; height: 60px; border-radius: 50%; background: #fff0f6; display: flex; justify-content: center; align-items: center; font-size: 30px; margin-right: 15px; }
.st-info { flex: 1; }
.st-name { font-size: 18px; font-weight: 800; color: #2d3436; }
.st-account { font-size: 12px; color: #b2bec3; margin-top: 4px; }
.settings-msg-box { background: #f8f9fa; padding: 15px; border-radius: 12px; margin-bottom: 20px; position: relative; }
.st-msg-label { font-size: 12px; color: var(--primary); font-weight: bold; margin-bottom: 5px; display: block; }
.st-msg-text { font-size: 14px; color: #2d3436; line-height: 1.4; }
.st-msg-edit { position: absolute; top: 15px; right: 15px; color: #b2bec3; cursor: pointer; }
.settings-menu { list-style: none; padding: 0; margin: 0 0 30px 0; }
.st-menu-item { padding: 15px 0; border-bottom: 1px solid #f1f2f6; display: flex; justify-content: space-between; cursor: pointer; font-size: 15px; color: #2d3436; }


/* ========================================
    바텀 시트 (Patch v4.4 - 위치 및 Z-Index 강제 고정)
======================================== */
.sheet-overlay {
    position: fixed !important; 
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.5);
    display: none;
    z-index: 10000 !important; 
    touch-action: none;
}

.sheet-overlay.open { display: block; }

/* 하얀색 팝업창 (Sheet) */
.bottom-sheet {
    position: fixed !important; 
    bottom: -100%; 
    left: 0; 
    right: 0;
    margin: 0 auto;
    max-width: 420px;
    width: 100%;
    background: white;
    border-radius: 20px 20px 0 0;
    padding: 30px 20px;
    box-sizing: border-box;
    transition: bottom 0.4s cubic-bezier(0.2, 0.8, 0.2, 1);
    z-index: 10001 !important; 
    max-height: 80vh; 
    overflow-y: auto; 
    box-shadow: 0 -5px 20px rgba(0,0,0,0.2);
}

/* 팝업 열릴 때 애니메이션 */
.sheet-overlay.open .bottom-sheet { 
    bottom: 0 !important; 
}

/* 팝업 내부 요소는 그대로 유지 */
.sheet-icon { font-size: 50px; margin-bottom: 15px; }
.sheet-title { font-size: 20px; font-weight: bold; margin-bottom: 10px; color: #2d3436; }
.sheet-desc { font-size: 14px; color: #636e72; margin-bottom: 30px; line-height: 1.5; }