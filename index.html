<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>It's me! v9.0 (Final Merge)</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        /* (ë””ìì¸ì€ v8.2ì™€ ë™ì¼ + í”„ë¡œí•„ ìˆ˜ì • ìŠ¤íƒ€ì¼ ì¶”ê°€) */
        :root { --primary: #6c5ce7; --bg: #f0f2f5; --card: #ffffff; --nav-height: 60px; }
        body { font-family: 'Pretendard', sans-serif; background-color: var(--bg); margin: 0; padding: 0; display: flex; justify-content: center; height: 100vh; overflow: hidden; }
        .app-container { width: 100%; max-width: 420px; background: var(--card); height: 100%; display: flex; flex-direction: column; position: relative; }
		/* [V9.0 Fix] DB ì—°ê²° ì‹ í˜¸ë“± (ìƒ‰ìƒê³¼ ìœ„ì¹˜ë¥¼ ì •ì˜) */
        .db-status { 
            position: absolute; 
            top: 10px; 
            right: 10px; 
            font-size: 10px; 
            font-weight: bold; 
            background: rgba(255,255,255,0.8); 
            border: 1px solid #00b894; /* í…Œë‘ë¦¬ */
            color: #00b894; /* í…ìŠ¤íŠ¸ ìƒ‰ìƒ (ë…¹ìƒ‰) */
            padding: 2px 6px; 
            border-radius: 8px; 
            display: none; 
            z-index:1000; 
        }
		/* [V9.0 Fix] DB ì—°ê²° ì‹ í˜¸ë“± */
        .db-status { position: absolute; top: 10px; right: 10px; font-size: 10px; font-weight: bold; background: #e6fffa; border: 1px solid #00b894; color: #00b894; padding: 2px 6px; border-radius: 8px; display: none; z-index:1000; }
        .db-status.on { display: block; }
		
        .screen { display: none; flex-direction: column; height: 100%; padding: 20px; padding-bottom: calc(20px + var(--nav-height)); box-sizing: border-box; overflow-y: auto; position: relative; }
        .screen.active { display: flex; }
        .bottom-nav { position: absolute; bottom: 0; left: 0; width: 100%; height: var(--nav-height); background: white; border-top: 1px solid #eee; display: none; justify-content: space-around; align-items: center; z-index: 50; }
        .app-container.logged-in .bottom-nav { display: flex; } 
        .nav-item { flex: 1; text-align: center; font-size: 10px; color: #b2bec3; cursor: pointer; padding: 5px 0; }
        .nav-item.active { color: var(--primary); font-weight: bold; }
        .nav-icon { font-size: 20px; display: block; margin-bottom: 2px; }
        h1, h2, h3 { color: #2d3436; margin: 0 0 15px 0; text-align: center; }
        p { color: #636e72; font-size: 15px; margin-bottom: 25px; text-align: center; }
        .btn { width: 100%; padding: 15px; border: none; border-radius: 12px; font-size: 16px; font-weight: 700; cursor: pointer; margin-bottom: 10px; transition: 0.1s; }
        .btn:active { transform: scale(0.98); }
        .btn-kakao { background-color: #FEE500; color: #191919; }
        .btn-primary { background-color: var(--primary); color: white; }
        .btn-outline { background: white; border: 2px solid #dfe6e9; color: #636e72; }
        .btn-pass { background: #f1f2f6; color: #a4b0be; font-size: 14px; margin-top: 20px; }
        .round-badge { background: #2d3436; color: white; padding: 5px 15px; border-radius: 20px; font-size: 14px; font-weight: bold; display: inline-block; margin-bottom: 15px; }
        .vs-container { display: flex; flex-direction: column; gap: 15px; flex: 1; justify-content: center; }
        .vs-card { padding: 15px; border: 2px solid #dfe6e9; border-radius: 16px; text-align: center; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 15px; transition: 0.2s; }
        .vs-card:active { border-color: var(--primary); background-color: #f0f3ff; transform: scale(0.98); }
        .vs-text-area { text-align: left; flex: 1; }
        .vs-name { font-size: 18px; font-weight: 800; }
        .vs-desc { font-size: 12px; color: #999; margin-top: 4px; font-weight: bold; }
        .vs-avatar { width: 50px; height: 50px; background: #eee; border-radius: 50%; display: flex; justify-content: center; align-items: center; font-size: 24px; margin-right: 10px; }
        .winner-box { text-align: center; padding: 40px 20px; animation: popUp 0.5s ease; }
        .winner-avatar { font-size: 80px; margin-bottom: 20px; display: inline-block; animation: bounce 1s infinite alternate; }
        @keyframes bounce { from { transform: translateY(0); } to { transform: translateY(-10px); } }
        @keyframes popUp { from { transform: scale(0.5); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        .mbti-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; margin-bottom: 15px; }
        .mbti-btn { padding: 10px 0; font-size: 13px; font-weight: bold; border: 1px solid #dfe6e9; border-radius: 8px; background: white; cursor: pointer; color: #636e72; }
        .mbti-btn:active { background: var(--primary); color: white; border-color: var(--primary); }
        .header-area { text-align: center; margin-bottom: 10px; }
        .header-title { font-size: 22px; font-weight: 800; color: #2d3436; margin: 0; }
        .header-badge { display: inline-block; background: #eee; padding: 4px 12px; border-radius: 20px; font-size: 12px; font-weight: bold; color: #636e72; margin-top: 5px; }
        .avatar-area { display: flex; justify-content: center; margin-bottom: 15px; }
        .avatar-circle { width: 80px; height: 80px; background: #fff0f6; border-radius: 50%; display: flex; justify-content: center; align-items: center; font-size: 40px; border: 3px solid white; box-shadow: 0 4px 10px rgba(0,0,0,0.1); position: relative; }
        .avatar-badge { position: absolute; bottom: 0; right: 0; background: var(--primary); color: white; font-size: 10px; padding: 3px 8px; border-radius: 10px; font-weight: bold; }
        .sub-tab-bar { display: flex; margin-bottom: 20px; background: #f1f2f6; border-radius: 12px; padding: 4px; }
        .sub-tab { flex: 1; text-align: center; padding: 8px 0; font-size: 14px; color: #636e72; border-radius: 10px; cursor: pointer; transition: 0.2s; font-weight: 500; }
        .sub-tab.active { background: white; color: var(--primary); font-weight: bold; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .sub-content { display: none; animation: fadeIn 0.3s ease; }
        .sub-content.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
        .chart-wrapper { width: 100%; height: 280px; position: relative; margin-bottom: 10px; display: flex; justify-content: center; align-items: center; }
        .list-wrap { list-style: none; padding: 0; margin: 0; }
        .list-item { display: flex; align-items: center; padding: 15px 0; border-bottom: 1px solid #eee; }
        .list-icon { font-size: 24px; margin-right: 15px; background: #f0f3ff; width: 40px; height: 40px; display: flex; justify-content: center; align-items: center; border-radius: 50%; }
        .list-content { flex: 1; }
        .list-sub { font-size: 12px; color: #b2bec3; margin-top: 4px; }
        .rank-header-area { margin-bottom: 10px; }
        .rank-filter-row { display: flex; align-items: center; gap: 10px; }
        .stat-pills { flex: 1; display: flex; gap: 8px; overflow-x: auto; padding-bottom: 5px; scrollbar-width: none; }
        .stat-pill { white-space: nowrap; padding: 6px 12px; border-radius: 20px; background: #f1f2f6; color: #636e72; font-size: 12px; font-weight: 600; cursor: pointer; border: 1px solid transparent;}
        .stat-pill.active { background: white; border-color: var(--primary); color: var(--primary); }
        .more-btn { font-size: 11px; color: #999; cursor: pointer; white-space: nowrap; padding: 5px; }
        .rank-list { list-style: none; padding: 0; margin: 0; }
        .rank-item { display: flex; align-items: center; padding: 15px 0; border-bottom: 1px solid #eee; cursor: pointer; position: relative; }
        .rank-item:active { background-color: #fafafa; }
        .rank-num { font-size: 18px; font-weight: bold; width: 35px; color: var(--primary); text-align: center; }
        .rank-avatar { font-size: 24px; margin-right: 12px; width: 36px; height: 36px; background: #eee; border-radius: 50%; display: flex; justify-content: center; align-items: center; }
        .rank-info { flex: 1; }
        .rank-name { font-weight: bold; font-size: 15px; color: #2d3436; }
        .rank-desc { font-size: 12px; color: #999; margin-top: 2px; }
        .rank-score { text-align: right; }
        .score-val { font-weight: 800; font-size: 16px; color: #2d3436; display: block; }
        .contribution { font-size: 10px; color: var(--primary); background: #f0f3ff; padding: 2px 6px; border-radius: 8px; font-weight: bold; }
        .achieve-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; }
        .achieve-item { background: #f8f9fa; border-radius: 12px; padding: 15px 5px; text-align: center; cursor: pointer; transition: 0.2s; }
        .achieve-item.unlocked .achieve-icon { opacity: 1; filter: none; }
        .achieve-icon { font-size: 30px; margin-bottom: 5px; opacity: 0.3; filter: grayscale(100%); }
        .achieve-title { font-size: 12px; font-weight: bold; color: #636e72; }
        .shop-section { margin-bottom: 30px; }
        .shop-title { font-size: 16px; font-weight: bold; color: #2d3436; margin-bottom: 10px; border-left: 4px solid var(--primary); padding-left: 10px; }
        .shop-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .shop-item { background: white; border: 1px solid #eee; border-radius: 12px; padding: 15px; text-align: center; box-shadow: 0 2px 5px rgba(0,0,0,0.03); cursor: pointer; }
        .shop-item:active { transform: scale(0.98); }
        .shop-item-img { font-size: 30px; margin-bottom: 5px; }
        .shop-item-name { font-size: 14px; font-weight: bold; margin-bottom: 5px; }
        .shop-item-price { font-size: 12px; color: var(--primary); font-weight: bold; }
        .cash-price { color: #00b894; }
        .empty-state { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255, 255, 255, 0.96); backdrop-filter: blur(5px); display: none; flex-direction: column; justify-content: center; align-items: center; z-index: 20; padding: 40px; box-sizing: border-box; text-align: center; }
        .empty-state.show { display: flex; }
        .empty-icon { font-size: 60px; margin-bottom: 20px; animation: float 3s ease-in-out infinite; }
        .empty-close { position: absolute; top: 20px; right: 20px; font-size: 24px; color: #ccc; cursor: pointer; }
        @keyframes float { 0% { transform: translateY(0px); } 50% { transform: translateY(-10px); } 100% { transform: translateY(0px); } }
        .sheet-overlay { position: absolute; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.5); display: none; z-index: 100; transition: opacity 0.3s; }
        .bottom-sheet { position: absolute; bottom: -100%; left: 0; width: 100%; background: white; border-radius: 20px 20px 0 0; padding: 30px 20px; box-sizing: border-box; transition: bottom 0.3s ease-out; z-index: 101; max-height: 80vh; overflow-y: auto; }
        .sheet-overlay.open { display: block; }
        .sheet-overlay.open .bottom-sheet { bottom: 0; }
        .sheet-icon { font-size: 50px; margin-bottom: 15px; }
        .sheet-title { font-size: 20px; font-weight: bold; margin-bottom: 10px; color: #2d3436; }
        .sheet-desc { font-size: 14px; color: #636e72; margin-bottom: 30px; line-height: 1.5; }
        .profile-header { text-align: center; margin-bottom: 20px; }
        .profile-avatar { font-size: 60px; margin-bottom: 10px; display: inline-block; background: #f8f9fa; width: 100px; height: 100px; line-height: 100px; border-radius: 50%; }
        .profile-name { font-size: 24px; font-weight: 800; color: #2d3436; margin-bottom: 5px; }
        .profile-msg { font-size: 14px; color: #636e72; font-style: italic; }
        .signal-list { list-style: none; padding: 0; margin: 0; text-align: left; }
        .signal-item { padding: 12px 0; border-bottom: 1px solid #f1f2f6; display: flex; justify-content: space-between; font-size: 14px; }
        .signal-label { color: #636e72; }
        .signal-val { font-weight: bold; color: var(--primary); }
        
        /* [ì„¤ì •] í”„ë¡œí•„ ìŠ¤íƒ€ì¼ */
        .settings-profile { display: flex; align-items: center; margin-bottom: 20px; padding-bottom: 20px; border-bottom: 1px solid #f1f2f6; }
        .st-avatar { width: 60px; height: 60px; border-radius: 50%; background: #fff0f6; display: flex; justify-content: center; align-items: center; font-size: 30px; margin-right: 15px; border: 2px solid #eee; }
        .st-info { flex: 1; }
        .st-name { font-size: 18px; font-weight: 800; color: #2d3436; }
        .st-account { font-size: 12px; color: #b2bec3; margin-top: 4px; }
        .settings-msg-box { background: #f8f9fa; padding: 15px; border-radius: 12px; margin-bottom: 20px; position: relative; }
        .st-msg-label { font-size: 12px; color: var(--primary); font-weight: bold; margin-bottom: 5px; display: block; }
        .st-msg-text { font-size: 14px; color: #2d3436; line-height: 1.4; }
        .st-msg-edit { position: absolute; top: 15px; right: 15px; color: #b2bec3; cursor: pointer; }
        .settings-menu { list-style: none; padding: 0; margin: 0 0 30px 0; }
        .st-menu-item { padding: 15px 0; border-bottom: 1px solid #f1f2f6; display: flex; justify-content: space-between; align-items: center; cursor: pointer; font-size: 15px; color: #2d3436; }
        .st-menu-item:last-child { border-bottom: none; }
        .st-arrow { color: #ccc; }
        
        .ticket-badge { font-size: 13px; font-weight: bold; color: #6c5ce7; background: #f0f3ff; padding: 5px 12px; border-radius: 20px; display: inline-block; margin-bottom: 10px; }
    </style>
</head>
<body>

<div class="app-container" id="mainContainer">
    <div id="dbStatus" class="db-status">â— DB OK</div>

    <div id="screen-login" class="screen active">
        <div style="flex:1; display:flex; flex-direction:column; justify-content:center; align-items:center;">
            <div style="font-size: 60px; margin-bottom: 20px;">ğŸ§</div><h1>It's me!</h1><p>ë‚¨ë“¤ì´ ë³´ëŠ” ì§„ì§œ ë‚˜,<br>3ì´ˆ ë§Œì— í™•ì¸í•´ë³´ì„¸ìš”.</p>
        </div>
        <button class="btn btn-kakao" onclick="loginWithServer()">ì¹´ì¹´ì˜¤ë¡œ ì‹œì‘í•˜ê¸°</button>
        <button class="btn btn-outline" onclick="loginWithServer()">ì´ë©”ì¼ë¡œ ì‹œì‘í•˜ê¸°</button>
    </div>

    <div id="screen-mbti" class="screen">
        <div style="height: 20px;"></div><h2 style="text-align:center;">ê¸°ì´ˆ ë°ì´í„° ì…ë ¥</h2>
        <div class="mbti-grid">
            <button class="mbti-btn" onclick="saveMbtiToServer('ENFP')">ENFP</button><button class="mbti-btn" onclick="saveMbtiToServer('ISTJ')">ISTJ</button><button class="mbti-btn" onclick="saveMbtiToServer('ENTP')">ENTP</button><button class="mbti-btn" onclick="saveMbtiToServer('INFJ')">INFJ</button>
            <button class="mbti-btn" onclick="saveMbtiToServer('ISTP')">ISTP</button><button class="mbti-btn" onclick="saveMbtiToServer('ISFP')">ISFP</button><button class="mbti-btn" onclick="saveMbtiToServer('INFP')">INFP</button><button class="mbti-btn" onclick="saveMbtiToServer('INTP')">INTP</button>
            <button class="mbti-btn" onclick="saveMbtiToServer('ESTP')">ESTP</button><button class="mbti-btn" onclick="saveMbtiToServer('ESFP')">ESFP</button><button class="mbti-btn" onclick="saveMbtiToServer('ESTJ')">ESTJ</button><button class="mbti-btn" onclick="saveMbtiToServer('ESFJ')">ESFJ</button>
            <button class="mbti-btn" onclick="saveMbtiToServer('ENFJ')">ENFJ</button><button class="mbti-btn" onclick="saveMbtiToServer('ENTJ')">ENTJ</button><button class="mbti-btn" onclick="saveMbtiToServer('INTJ')">INTJ</button><button class="mbti-btn" onclick="saveMbtiToServer('ISFJ')">ISFJ</button>
        </div>
        <button class="btn btn-primary" onclick="goScreen('screen-test-1')">ğŸ¤” ì˜ ëª¨ë¥´ê² ì–´ìš” (30ì´ˆ í…ŒìŠ¤íŠ¸)</button>
    </div>

    <div id="screen-test-1" class="screen">
        <div style="flex:1; display:flex; flex-direction:column; justify-content:center;">
            <h3 style="text-align:center;">Q1. ë¶ˆê¸ˆì´ë‹¤!<br>ì¹œêµ¬ë“¤ì´ ë¶€ë¥´ë©´?</h3>
            <button class="btn btn-outline" onclick="nextTest('E', 'screen-test-2')">ì˜¤ì˜ˆ! ë‹¹ì¥ ë‚˜ê°„ë‹¤! (E)</button>
            <button class="btn btn-outline" onclick="nextTest('I', 'screen-test-2')">ê¸° ë¹¨ë ¤... ì§‘ì´ ìµœê³ ì•¼. (I)</button>
        </div>
    </div>
    <div id="screen-test-2" class="screen">
        <div style="flex:1; display:flex; flex-direction:column; justify-content:center;">
            <h3 style="text-align:center;">Q2. ë© ë•Œë¦´ ë•Œ<br>ë¬´ìŠ¨ ìƒê°í•´?</h3>
            <button class="btn btn-outline" onclick="nextTest('S', 'screen-test-3')">ë°°ê³ íŒŒ... ì €ë… ë­ ë¨¹ì§€? (S)</button>
            <button class="btn btn-outline" onclick="nextTest('N', 'screen-test-3')">ì¢€ë¹„ê°€ ë‚˜íƒ€ë‚˜ë©´ ì–´ë–¡í•˜ì§€? (N)</button>
        </div>
    </div>
    <div id="screen-test-3" class="screen">
        <div style="flex:1; display:flex; flex-direction:column; justify-content:center;">
            <h3 style="text-align:center;">Q3. ì¹œêµ¬ê°€ ìš°ìš¸í•´ì„œ<br>í™”ë¶„ ìƒ€ë‹¤ê³  í•˜ë©´?</h3>
            <button class="btn btn-outline" onclick="nextTest('T', 'screen-test-4')">ë¬´ìŠ¨ í™”ë¶„ ìƒ€ì–´? ì–¼ë§ˆì•¼? (T)</button>
            <button class="btn btn-outline" onclick="nextTest('F', 'screen-test-4')">í—... ë¬´ìŠ¨ ì¼ ìˆì–´? ã… ã…  (F)</button>
        </div>
    </div>
    <div id="screen-test-4" class="screen">
        <div style="flex:1; display:flex; flex-direction:column; justify-content:center;">
            <h3 style="text-align:center;">Q4. ì—¬í–‰ ê°ˆ ë•Œ<br>ê³„íšì€?</h3>
            <button class="btn btn-outline" onclick="finishTest('J')">ì—‘ì…€ ì¼œê³  ë¶„ ë‹¨ìœ„ ì¼ì •í‘œ (J)</button>
            <button class="btn btn-outline" onclick="finishTest('P')">ì—¬ê¶Œë§Œ ì±™ê²¨ì„œ ì¶œë°œ! (P)</button>
        </div>
    </div>

    <div id="screen-main" class="screen">
        <div class="header-area"><h2 class="header-title">ë‚˜ì˜ ê±°ìš¸</h2><div class="header-badge">ğŸ‘‘ ìƒìœ„ 12% (ì¢…í•©)</div></div>
        <div class="avatar-area"><div class="avatar-circle"><span id="myAvatar">ğŸ¦Š</span><div class="avatar-badge" id="myMbtiBadge">#???</div></div></div>
        <div class="sub-tab-bar">
            <div class="sub-tab active" onclick="goSubTab('tab-prism', this)">í”„ë¦¬ì¦˜</div>
            <div class="sub-tab" onclick="goSubTab('tab-history', this)">ë°œìì·¨</div>
            <div class="sub-tab" onclick="goSubTab('tab-trophy', this)">ì—…ì </div>
        </div>
        <div id="tab-prism" class="sub-content active">
            <div class="chart-wrapper"><canvas id="myRadarChart"></canvas></div>
            <div style="background: #f8f9fa; padding: 15px; border-radius: 12px; margin-bottom: 15px; text-align:center;">
                <div style="font-size: 12px; color: #636e72; margin-bottom: 5px;">ğŸ’¬ ë‚˜ì˜ í•œë§ˆë””</div>
                <div id="mainMsg" style="font-weight: bold; color: #2d3436; font-size: 14px;">"ìƒíƒœ ë©”ì‹œì§€ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”"</div>
            </div>
        </div>
        <div id="tab-history" class="sub-content">
            <ul class="list-wrap"><li class="list-item"><div class="list-icon">ğŸ“ˆ</div><div class="list-content"><div style="font-weight:bold;">[ì¼ë¨¸ë¦¬] ì ìˆ˜ ìƒìŠ¹!</div><div class="list-sub">ë°©ê¸ˆ ì „ Â· ê¹€ ëŒ€ë¦¬ë‹˜ í‰ê°€</div></div><div style="color:#e74c3c; font-weight:bold;">+10</div></li></ul>
        </div>
        <div id="tab-trophy" class="sub-content">
            <div class="achieve-grid"><div class="achieve-item unlocked" onclick="openSheet('ğŸ‘¶', 'ì²« ê±¸ìŒ', 'ê°€ì…ì„ í™˜ì˜í•©ë‹ˆë‹¤!', '2025.12.05')"><div class="achieve-icon">ğŸ‘¶</div><div class="achieve-title">ì²« ê±¸ìŒ</div></div><div class="achieve-item"><div class="achieve-icon">ğŸ”¥</div><div class="achieve-title">ì—´ì •</div></div><div class="achieve-item"><div class="achieve-icon">ğŸ‘‘</div><div class="achieve-title">ì¸ê¸°ì¸</div></div></div>
        </div>
    </div>

    <div id="screen-vote" class="screen">
        <div style="text-align:center; margin-top:10px;">
            <span class="ticket-badge" id="ticketDisplay">ğŸ« ë‚¨ì€ í‹°ì¼“: 5/5</span>
            <br>
            <span class="round-badge" id="roundBadge">í† ë„ˆë¨¼íŠ¸ ì‹œì‘</span>
            <h3 id="voteTitle" style="text-align:center; min-height:50px; margin-top:10px;">ì§ˆë¬¸ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</h3>
        </div>
        <div class="vs-container" id="vsContainer">
            <div class="vs-card" onclick="vote(0)">
                <div class="vs-avatar" id="avatarA">â“</div>
                <div class="vs-text-area"><div class="vs-name" id="nameA">...</div><div class="vs-desc" id="descA">...</div></div>
            </div>
            <div style="text-align:center; font-weight:bold; color:#ccc;">VS</div>
            <div class="vs-card" onclick="vote(1)">
                <div class="vs-avatar" id="avatarB">â“</div>
                <div class="vs-text-area"><div class="vs-name" id="nameB">...</div><div class="vs-desc" id="descB">...</div></div>
            </div>
        </div>
        <div id="winnerContainer" style="display:none; flex:1; flex-direction:column; justify-content:center; align-items:center;">
            <div class="winner-box">
                <div class="winner-avatar" id="winnerAvatar">ğŸ†</div>
                <h2 style="margin-bottom:5px;">ìš°ìŠ¹!</h2>
                <h1 id="winnerName" style="font-size:30px; color:var(--primary);">...</h1>
                <p id="winnerText">ì´ ì¹œêµ¬ì—ê²Œ ì ìˆ˜ê°€ ì „ë‹¬ë˜ì—ˆìŠµë‹ˆë‹¤.</p>
                <button class="btn btn-primary" onclick="startTournament()">ë‹¤ìŒ í† ë„ˆë¨¼íŠ¸ ì‹œì‘í•˜ê¸°</button>
            </div>
        </div>
        <button class="btn btn-pass" id="passBtn" onclick="startTournament()">ğŸ¤” ì˜ ëª¨ë¥´ëŠ” ì‚¬ëŒë“¤ì´ì—ìš” (ìƒˆë¡œê³ ì¹¨)</button>
    </div>

    <div id="screen-rank" class="screen">
        <div class="rank-header-area">
            <h2 style="text-align:center;">ì¹œêµ¬ ë­í‚¹</h2>
            <div class="rank-filter-row"><div class="stat-pills"><div class="stat-pill active" onclick="filterRank(this, -1)">ì¢…í•©</div><div class="stat-pill" onclick="filterRank(this, 0)">ì¼ë¨¸ë¦¬</div><div class="stat-pill" onclick="filterRank(this, 1)">ìœ ë¨¸</div><div class="stat-pill" onclick="filterRank(this, 2)">ì˜ë¦¬</div><div class="stat-pill" onclick="filterRank(this, 3)">ì„¼ìŠ¤</div><div class="stat-pill" onclick="filterRank(this, 4)">ë§¤ë ¥</div><div class="stat-pill" onclick="filterRank(this, 5)">ê´‘ê¸°</div></div><div class="more-btn" onclick="openSheet('ğŸ†', 'ì „ì²´ ìˆœìœ„', 'ì¤€ë¹„ ì¤‘')">ë” ë³´ê¸° ></div></div>
        </div>
        <ul class="list-wrap" id="rankListContainer"></ul>
        <div id="emptyRankState" class="empty-state">
            <div class="empty-close" onclick="toggleEmptyState()">âœ•</div>
            <div class="empty-icon">ğŸƒ</div><h3 style="margin-bottom:10px;">ë„ˆë¬´ ì¡°ìš©í•œë°ìš”?</h3><p style="margin-bottom:30px;">ì•„ì§ ì¹œêµ¬ê°€ ì—†ì–´ìš”.</p><button class="btn btn-primary" style="width:auto; padding:12px 30px;" onclick="alert('ë§í¬ ë³µì‚¬ë¨!')">ì¹œêµ¬ ì´ˆëŒ€í•˜ê¸°</button>
        </div>
    </div>

<div id="screen-shop" class="screen">
        <h2 style="text-align:center;">ìƒì </h2>
        <div style="text-align:center; margin-bottom:10px; font-weight:bold; color:var(--primary);">ë‚´ ë³´ìœ  í† í°: <span id="shopTokenDisplay">0</span> ğŸ’</div>
        
        <div class="shop-section">
            <div class="shop-title">ğŸ’ í† í° ì¶©ì „ì†Œ</div>
            <div class="shop-grid">
                <div class="shop-item" onclick="alert('ê²°ì œ API ì—°ë™ í•„ìš”!')"><div class="shop-item-img">ğŸ’°</div><div class="shop-item-name">í† í° 100ê°œ</div><div class="shop-item-price cash-price">â‚© 1,200</div></div>
                <div class="shop-item" onclick="alert('ê²°ì œ API ì—°ë™ í•„ìš”!')"><div class="shop-item-img">ğŸ’°</div><div class="shop-item-name">í† í° 550ê°œ</div><div class="shop-item-price cash-price">â‚© 5,900</div></div>
            </div>
        </div>

        <div class="shop-section">
            <div class="shop-title">ğŸ¦Š ì•„ë°”íƒ€ ìŠ¤í‚¨</div>
            <div class="shop-grid">
                <div class="shop-item" onclick="purchaseItem(50, 'Avatar', 'ğŸ¯')"><div class="shop-item-img">ğŸ¯</div><div class="shop-item-name">í˜¸ë‘ì´</div><div class="shop-item-price">ğŸ’ 50</div></div>
                <div class="shop-item" onclick="purchaseItem(50, 'Avatar', 'ğŸ°')"><div class="shop-item-img">ğŸ°</div><div class="shop-item-name">í† ë¼</div><div class="shop-item-price">ğŸ’ 50</div></div>
            </div>
        </div>
        
        <div class="shop-section">
            <div class="shop-title">ğŸ’ ì•„ì´í…œ ìƒì </div>
            <div class="shop-grid">
                <div class="shop-item" onclick="purchaseItem(100, 'Banner', 'ì‘ì› ë°°ë„ˆ')"><div class="shop-item-img">ğŸ“¢</div><div class="shop-item-name">ì‘ì› ë°°ë„ˆ</div><div class="shop-item-price">ğŸ’ 100</div></div>
                <div class="shop-item" onclick="purchaseItem(200, 'Skin', 'í™©ê¸ˆ ìŠ¤í‚¨')"><div class="shop-item-img">ğŸ¨</div><div class="shop-item-name">í™©ê¸ˆ ìŠ¤í‚¨</div><div class="shop-item-price">ğŸ’ 200</div></div>
            </div>
        </div>
    </div>

    <div id="screen-settings" class="screen">
        <h2 style="text-align:center;">ì„¤ì •</h2>
        <div class="settings-profile"><div class="st-avatar">ğŸ¦Š</div><div class="st-info"><div class="st-name">ë‚˜ (Me)</div><div class="st-account">kakao_u***</div></div></div>
        <div class="settings-msg-box">
            <span class="st-msg-label">ë‚˜ì˜ í•œë§ˆë””</span>
            <div class="st-msg-text" id="settingMsg">"ìƒíƒœ ë©”ì‹œì§€ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”"</div>
            <div class="st-msg-edit" onclick="editProfileMsg()">âœï¸</div>
        </div>
        <ul class="settings-menu">
            <li class="st-menu-item" onclick="alert('êµ¬ë§¤ ê¸°ë¡')"><span>ğŸ’° êµ¬ë§¤ ê¸°ë¡</span><span class="st-arrow">></span></li>
            <li class="st-menu-item"><span>ğŸ”” ì•Œë¦¼ ì„¤ì •</span><span class="st-arrow">></span></li>
            <li class="st-menu-item"><span>ğŸ“œ ì´ìš© ì•½ê´€</span><span class="st-arrow">></span></li>
        </ul>
        <button class="btn" style="background:#eee; color:#ff4757;" onclick="logout()">ë¡œê·¸ì•„ì›ƒ</button>
    </div>

    <div class="bottom-nav">
        <div class="nav-item active" onclick="goTab('screen-main', this)"><span class="nav-icon">ğŸª</span>ê±°ìš¸</div>
        <div class="nav-item" onclick="goTab('screen-vote', this)"><span class="nav-icon">âš–ï¸</span>í‰ê°€</div>
        <div class="nav-item" onclick="goTab('screen-rank', this)"><span class="nav-icon">ğŸ†</span>ë­í‚¹</div>
        <div class="nav-item" onclick="goTab('screen-shop', this)"><span class="nav-icon">ğŸ›ï¸</span>ìƒì </div>
        <div class="nav-item" onclick="goTab('screen-settings', this)"><span class="nav-icon">âš™ï¸</span>ì„¤ì •</div>
    </div>

    <div id="bottomSheetOverlay" class="sheet-overlay" onclick="closeSheet()">
        <div class="bottom-sheet" onclick="event.stopPropagation()">
            <div class="sheet-icon" id="sheetIcon">ğŸ</div><div class="sheet-title" id="sheetTitle">ì œëª©</div><div class="sheet-desc" id="sheetDesc">ë‚´ìš©</div><div style="font-size:12px; color:#b2bec3; margin-bottom:20px;" id="sheetSub">ë¶€ê°€ì •ë³´</div><button class="btn btn-primary" onclick="closeSheet()">í™•ì¸</button>
        </div>
    </div>
    <div id="profileSheetOverlay" class="sheet-overlay" onclick="closeSheet()">
        <div class="bottom-sheet" onclick="event.stopPropagation()">
            <div class="profile-header"><div class="profile-avatar" id="pfAvatar">ğŸ¶</div><div class="profile-name" id="pfName">ì´ ê³¼ì¥</div><div class="profile-msg" id="pfMsg">"ì¸ìƒì€ ì‹¤ì „ì´ë‹¤"</div></div>
            <div style="background:#f8f9fa; padding:15px; border-radius:12px;"><h4 style="margin:0 0 10px 0; color:#2d3436;">ğŸ’Œ ë‚´ê°€ ë³´ë‚¸ ì‹œê·¸ë„</h4><ul class="signal-list"><li class="signal-item"><span class="signal-label">ì¼ë¨¸ë¦¬ í‰ê°€</span><span class="signal-val">A (ìƒìœ„ 1%)</span></li></ul></div><br><button class="btn btn-primary" onclick="closeSheet()">ë‹«ê¸°</button>
        </div>
    </div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getFirestore, doc, setDoc, getDoc, collection, getDocs } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    // [ì„ ë°°ë‹˜ Key]
    const firebaseConfig = {
      apiKey: "AIzaSyCZJB72jkS2rMgM213Wu9fEuW4Q4jN1scc",
      authDomain: "it-s-me-96d66.firebaseapp.com",
      projectId: "it-s-me-96d66",
      storageBucket: "it-s-me-96d66.firebasestorage.app",
      messagingSenderId: "950221311348",
      appId: "1:950221311348:web:43c851b6a4d7446966f021",
      measurementId: "G-J3SYEX4SYW"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // ì „ì—­ ë³€ìˆ˜
    window.questions = [];
    window.candidates = [];
    window.tournamentRound = [];
    window.nextRound = [];
    window.currentQ = null;
    window.currentFilter = -1;
    window.myInfo = { tickets: 5, lastTicketDate: "", msg: "ìƒíƒœ ë©”ì‹œì§€ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”", tokens: 0 }; 

    window.initGame = async function() {
        try {
            const qSnap = await getDocs(collection(db, "questions"));
            qSnap.forEach(doc => window.questions.push(doc.data()));
            
            const uSnap = await getDocs(collection(db, "users"));
            uSnap.forEach(doc => {
                let d = doc.data();
                if(!d.stats) d.stats = [50,50,50,50,50,50];
                if(d.isNPC) { d.id = doc.id; window.candidates.push(d); }
            });
            checkAndResetTickets();
            if(window.questions.length > 0 && window.candidates.length >= 2) {
                renderRankList(window.currentFilter); 
                startTournament(); 
				
			// [NEW í—¬í¼ í•¨ìˆ˜] ìš°ìŠ¹ìì—ê²Œ í† í°ì„ ì§€ê¸‰í•˜ê³  DBì— ë°˜ì˜í•˜ëŠ” í•¨ìˆ˜
			async function updateWinnerTokens(uid, amount) {
				if (!uid) return;
				const userRef = doc(db, "users", uid);
				
				try {
					// FieldValue.incrementëŠ” Firestore SDKì—ì„œ ê°€ì ¸ì™€ì•¼ í•˜ì§€ë§Œ, 
					// í˜„ì¬ ì½”ë“œì—ëŠ” í¬í•¨ë˜ì–´ ìˆì§€ ì•Šìœ¼ë¯€ë¡œ ë‹¨ìˆœí™”ë¥¼ ìœ„í•´ ë®ì–´ì“°ê¸°ë¡œ êµ¬í˜„í•©ë‹ˆë‹¤.
					// (ì‹¤ì œ ì„œë¹„ìŠ¤ì—ì„œëŠ” FieldValue.incrementë¥¼ ì‚¬ìš©í•´ì•¼ ê¸°ì¡´ í† í°ì— ë”í•´ì§‘ë‹ˆë‹¤.)
					await setDoc(userRef, { tokens: amount }, { merge: true }); 
					console.log(`[DB Token] ${uid}ì—ê²Œ ${amount} í† í° ì§€ê¸‰ ì™„ë£Œ.`);
				} catch(e) {
					console.error("í† í° ì§€ê¸‰ ì¤‘ ë¬¸ì œ ë°œìƒ:", e); 
				}
			}	
				
				
				
            }
        } catch(e) { console.error(e); }
    }

    window.checkAndResetTickets = async function() {
        const today = new Date().toLocaleDateString();
        const uid = getUserId();
        const docRef = doc(db, "users", uid);
        const docSnap = await getDoc(docRef);
        
        if (docSnap.exists()) {
            const data = docSnap.data();
            // [New] ë©”ì‹œì§€ì™€ í† í° ë¶ˆëŸ¬ì˜¤ê¸°
            if(data.msg) window.myInfo.msg = data.msg;
            if(data.tokens) window.myInfo.tokens = data.tokens;

            if (data.lastTicketDate !== today) {
                window.myInfo.tickets = 5; window.myInfo.lastTicketDate = today;
                saveMyInfoToDB();
            } else {
                window.myInfo.tickets = data.tickets !== undefined ? data.tickets : 5;
                window.myInfo.lastTicketDate = data.lastTicketDate;
            }
        } else {
            window.myInfo.tickets = 5; window.myInfo.lastTicketDate = today;
            saveMyInfoToDB();
        }
        updateTicketUI();
        updateProfileUI(); // í™”ë©´ ê°±ì‹ 
    }

    // [New] í”„ë¡œí•„ ìˆ˜ì • (DB ì €ì¥ í¬í•¨)
    window.editProfileMsg = async function() {
        let newMsg = prompt("ë‚˜ì˜ í•œ ë§ˆë””ë¥¼ ì…ë ¥í•˜ì„¸ìš”:", window.myInfo.msg);
        if(newMsg) {
            window.myInfo.msg = newMsg;
            updateProfileUI();
            
            const uid = getUserId();
            try {
                await setDoc(doc(db, "users", uid), { msg: newMsg }, { merge: true });
                console.log("í•œë§ˆë”” ì €ì¥ ì™„ë£Œ");
            } catch(e) { console.error(e); }
        }
    }

    function saveMyInfoToDB() {
        const uid = getUserId();
        setDoc(doc(db, "users", uid), { 
            tickets: window.myInfo.tickets, 
            lastTicketDate: window.myInfo.lastTicketDate,
            tokens: window.myInfo.tokens // í† í° ì €ì¥
        }, { merge: true });
    }

    function updateTicketUI() { 
        const el = document.getElementById('ticketDisplay'); 
        if(el) el.innerText = `ğŸ« ë‚¨ì€ í‹°ì¼“: ${window.myInfo.tickets}/5`; 
    }

    // [New] í”„ë¡œí•„ UI ê°±ì‹ 
    function updateProfileUI() {
        document.getElementById('mainMsg').innerText = `"${window.myInfo.msg}"`;
        document.getElementById('settingMsg').innerText = `"${window.myInfo.msg}"`;
        document.getElementById('shopTokenDisplay').innerText = window.myInfo.tokens;
    }

    // (ì´í•˜ í† ë„ˆë¨¼íŠ¸, ì €ì¥, ë¡œë“œ ë¡œì§ì€ v8.2ì™€ ë™ì¼)
    window.startTournament = function() {
        if (window.myInfo.tickets <= 0) { alert("í‹°ì¼“ ì†Œì§„!"); return; }
        document.getElementById('vsContainer').style.display = 'flex';
        document.getElementById('winnerContainer').style.display = 'none';
        document.getElementById('passBtn').style.display = 'block';
        window.currentQ = window.questions[Math.floor(Math.random() * window.questions.length)];
        document.getElementById('voteTitle').innerText = window.currentQ.text;
        let players = [...window.candidates].sort(() => Math.random() - 0.5);
        if(players.length >= 4) players = players.slice(0, 4); else players = players.slice(0, 2);
        window.tournamentRound = players; window.nextRound = [];
        updateRoundTitle(); showMatch();
    }
    function updateRoundTitle() { let count = window.tournamentRound.length; document.getElementById('roundBadge').innerText = count === 4 ? "ğŸ† 4ê°•ì „" : (count === 2 ? "ğŸ‘‘ ê²°ìŠ¹ì „" : `ğŸ† ${count}ê°•ì „`); }
    function showMatch() {
        if(window.tournamentRound.length < 2) {
            if(window.nextRound.length === 1) { showWinner(window.nextRound[0]); return; }
            window.tournamentRound = window.nextRound; window.nextRound = []; updateRoundTitle();
        }
        updateCard('A', window.tournamentRound[0]); updateCard('B', window.tournamentRound[1]);
    }
    function updateCard(pos, user) { document.getElementById('name'+pos).innerText = user.nickname; document.getElementById('desc'+pos).innerText = user.desc; document.getElementById('avatar'+pos).innerText = user.avatar; }
    window.vote = async function(idx) {
        const p1 = window.tournamentRound.shift(); const p2 = window.tournamentRound.shift();
        const winner = idx === 0 ? p1 : p2; window.nextRound.push(winner); showMatch();
    }
function showWinner(winner) {
        window.myInfo.tickets--; 
        window.myInfo.tokens += 10; // (í‰ê°€ì: ë‚˜) í† í° 10ê°œ íšë“ (ì°¸ì—¬ ë³´ìƒ)
        updateTicketUI(); updateProfileUI(); saveMyInfoToDB();

        document.getElementById('vsContainer').style.display = 'none';
        document.getElementById('passBtn').style.display = 'none';
        document.getElementById('winnerContainer').style.display = 'flex';
        document.getElementById('winnerName').innerText = winner.nickname;
        document.getElementById('winnerAvatar').innerText = winner.avatar;
        document.getElementById('roundBadge').innerText = "ğŸ‰ ìš°ìŠ¹ ğŸ‰";
        confetti({ particleCount: 100, spread: 70, origin: { y: 0.6 } });
        
        // [V9.0 í•µì‹¬] ìš°ìŠ¹ìì—ê²Œ í† í° 50ê°œ ì§€ê¸‰!
        updateWinnerTokens(winner.id, 50); 
        
        saveScore(winner, 20); // ì ìˆ˜ ë°˜ì˜
    }
    async function saveScore(winner, score) {
        if (!winner.stats) winner.stats = [50,50,50,50,50,50];
        const statIdx = window.currentQ.type !== undefined ? window.currentQ.type : 0;
        winner.stats[statIdx] += score; 
        renderRankList(window.currentFilter);
        try { const userRef = doc(db, "users", winner.id); await setDoc(userRef, { stats: winner.stats }, { merge: true }); } catch(e) {}
    }
    window.renderRankList = function(filterIndex = -1) {
        const container = document.getElementById('rankListContainer'); if (!container) return; container.innerHTML = '';
        const sortedList = [...window.candidates].sort((a, b) => {
            let scoreA = 0, scoreB = 0;
            if (filterIndex === -1) { scoreA = a.stats.reduce((sum, v) => sum + v, 0); scoreB = b.stats.reduce((sum, v) => sum + v, 0); } 
            else { scoreA = a.stats[filterIndex]; scoreB = b.stats[filterIndex]; }
            return scoreB - scoreA;
        });
        sortedList.forEach((item, index) => {
            const li = document.createElement('li'); li.className = 'list-item'; li.onclick = () => openProfile(item);
            if(item.id === getUserId()) li.style.backgroundColor = '#f0f3ff';
            let displayScore = 0;
            if (filterIndex === -1) displayScore = item.stats.reduce((sum, v) => sum + v, 0); else displayScore = item.stats[filterIndex];
            li.innerHTML = `<div class="rank-num">${index + 1}</div><div class="list-icon">${item.avatar || "ğŸ‘¤"}</div><div class="list-content"><div style="font-weight:bold; font-size:15px;">${item.nickname}</div><div class="list-sub">${item.desc || item.nickname}</div></div><div class="rank-score"><span class="score-val">${displayScore}ì </span></div>`;
            container.appendChild(li);
        });
    }
    window.filterRank = function(el, typeIndex) { document.querySelectorAll('.stat-pill').forEach(p => p.classList.remove('active')); el.classList.add('active'); window.currentFilter = typeIndex; renderRankList(typeIndex); }
    function getUserId() { let uid = localStorage.getItem('my_uid'); if (!uid) { uid = 'user_' + Math.random().toString(36).substr(2, 9); localStorage.setItem('my_uid', uid); } return uid; }
    window.saveMbtiToServer = async function(mbti) { setMyTypeUI(mbti); const uid = getUserId(); try { await setDoc(doc(db, "users", uid), { mbti: mbti, lastLogin: new Date().toISOString() }, { merge: true }); } catch (e) {} }
	window.loadDataFromServer = async function() {
        const uid = getUserId();
        try {
            const docSnap = await getDoc(doc(db, "users", uid));
            if (docSnap.exists()) {
                const data = docSnap.data();
                if(data.mbti) setMyTypeUI(data.mbti);
            }
            initGame();
            document.getElementById('dbStatus').classList.add('on'); // [V9.0 Fix] ì‹ í˜¸ë“± ON
        } catch (e) {
            console.error("DB ë¡œë“œ ì‹¤íŒ¨:", e);
        }
    }
    loadDataFromServer();
</script>

<script>
    let myMbti = "";
    let tempTestResult = [];
    function setMyTypeUI(mbti) {
        myMbti = mbti; const badge = document.getElementById('myMbtiBadge'); if(badge) badge.innerText = "#" + mbti;
        document.getElementById('screen-login').classList.remove('active');
        document.getElementById('screen-mbti').classList.remove('active');
        document.getElementById('mainContainer').classList.add('logged-in');
        goTab('screen-main', document.querySelector('.nav-item:first-child'));
    }
    function logout() { localStorage.clear(); location.reload(); }
    function loginWithServer() { goScreen('screen-mbti'); }
    
    // [New] í…ŒìŠ¤íŠ¸ ë¡œì§ (ê²½ë¡œ ëª…ì‹œì  ì§€ì •)
    function nextTest(val, nextScreenId) {
        tempTestResult.push(val); 
        goScreen(nextScreenId);
    }
    function finishTest(lastVal) {
        tempTestResult.push(lastVal);
        // ì•½ì‹ ì•Œê³ ë¦¬ì¦˜ (ì‹¤ì œë¡  4ê°œ ì¡°í•©)
        let finalMbti = "ENFP"; // ì„ì‹œ
        alert("ë¶„ì„ ì™„ë£Œ! ë‹¹ì‹ ì€ " + finalMbti + " ìœ í˜•ì…ë‹ˆë‹¤.");
        saveMbtiToServer(finalMbti);
    }
    
    function openSheet(icon, title, desc, sub="") {
        document.getElementById('sheetIcon').innerText = icon;
        document.getElementById('sheetTitle').innerText = title;
        document.getElementById('sheetDesc').innerHTML = desc;
        document.getElementById('sheetSub').innerText = sub;
        document.getElementById('bottomSheetOverlay').classList.add('open');
    }
    function closeSheet() { document.querySelectorAll('.sheet-overlay').forEach(el => el.classList.remove('open')); }
	
	// [NEW] í† í° ì†Œëª¨ ë° ì•„ì´í…œ ì ìš© ë¡œì§
    window.purchaseItem = async function(cost, itemType, itemValue) {
        if (window.myInfo.tokens < cost) {
            openSheet('âŒ', 'í† í° ë¶€ì¡±', `í˜„ì¬ ë³´ìœ  í† í°: ${window.myInfo.tokens}ê°œì…ë‹ˆë‹¤.<br>ìƒì ì—ì„œ ì¶©ì „í•´ì£¼ì„¸ìš”.`, 'êµ¬ë§¤ ì‹¤íŒ¨');
            return;
        }

        if(!confirm(`ì •ë§ë¡œ ${cost}ğŸ’ë¥¼ ì‚¬ìš©í•´ [${itemType}]ì„ êµ¬ë§¤í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) return;

        // 1. ë¡œì»¬ ë°ì´í„° ì—…ë°ì´íŠ¸
        window.myInfo.tokens -= cost;
        
        // 2. ì•„ë°”íƒ€/ì•„ì´í…œ ì ìš© (ì„ì‹œ)
        if (itemType === 'Avatar') {
            document.getElementById('myAvatar').innerText = itemValue; // UI ì ìš©
            window.myInfo.avatar = itemValue; // DB ì €ì¥ìš©ìœ¼ë¡œ ìƒíƒœ ì €ì¥
        }
        
        updateProfileUI(); // í† í° UI ê°±ì‹ 
        saveMyInfoToDB(); // DB ì €ì¥

        openSheet('âœ…', 'êµ¬ë§¤ ì™„ë£Œ!', `ë‚¨ì€ í† í°: ${window.myInfo.tokens}ğŸ’<br>[${itemType}]ì´ ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤!`, 'í† í° ì†Œëª¨');
    }
    function toggleEmptyState() { const el = document.getElementById('emptyRankState'); el.classList.toggle('show'); }
    function goTab(screenId, navEl) {
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        document.getElementById(screenId).classList.add('active');
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
        if(navEl) navEl.classList.add('active');
        if(screenId === 'screen-main') { goSubTab('tab-prism', document.querySelector('.sub-tab:first-child')); }
        if(screenId === 'screen-rank') { setTimeout(() => { document.getElementById('emptyRankState').classList.add('show'); }, 100); }
    }
    function goSubTab(contentId, tabEl) {
        document.querySelectorAll('.sub-content').forEach(c => c.classList.remove('active'));
        document.getElementById(contentId).classList.add('active');
        document.querySelectorAll('.sub-tab').forEach(t => t.classList.remove('active'));
        if(tabEl) tabEl.classList.add('active');
        if(contentId === 'tab-prism') setTimeout(drawChart, 50);
    }
    function goScreen(screenId) {
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        document.getElementById(screenId).classList.add('active');
    }
    function openProfile(data) { document.getElementById('pfName').innerText = data.nickname; document.getElementById('pfAvatar').innerText = data.avatar; document.getElementById('pfMsg').innerText = data.desc; document.getElementById('profileSheetOverlay').classList.add('open'); }
    let myChart = null;
    function drawChart() { const ctx = document.getElementById('myRadarChart'); if(!ctx) return; if(myChart) myChart.destroy(); myChart = new Chart(ctx, { type: 'radar', data: { labels: ['ì¼ë¨¸ë¦¬', 'ìœ ë¨¸', 'ì˜ë¦¬', 'ì„¼ìŠ¤', 'ë§¤ë ¥', 'ê´‘ê¸°'], datasets: [{ label: 'ë‚´ ì ìˆ˜', data: [85, 70, 90, 75, 80, 40], backgroundColor: 'rgba(108, 92, 231, 0.2)', borderColor: '#6c5ce7', borderWidth: 2 }] }, options: { scales: { r: { suggestedMin: 0, suggestedMax: 100 } }, plugins: { legend: { display: false } } } }); }
</script>
</body>
</html>