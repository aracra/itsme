<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>It's me! v31.0 (End Game)</title>
    <link rel="stylesheet" href="style.css?v=31.0">
</head>
<body>

<div class="app-container" id="mainContainer">
    
    <div style="position: absolute; top: 10px; left: 10px; z-index: 2000; display:flex; flex-direction:column; align-items:flex-start; gap:5px;">
        <div style="display:flex; gap:5px;">
            <div id="dbStatus" class="db-status">● 연결 중</div>
            <button onclick="toggleDevMenu()" class="btn-dev-toggle">⚙️ Dev</button>
        </div>
        <div id="devMenuExpanded" style="display:none; flex-direction:column; gap:5px; background:rgba(0,0,0,0.8); padding:8px; border-radius:8px; backdrop-filter:blur(5px);">
            <button onclick="if(window.initializeTestDB) { initializeTestDB(); }" class="btn-dev-item">🔄 리셋</button>
            <button onclick="if(window.refillTickets) { window.refillTickets(); }" class="btn-dev-item">🎫 티켓</button>
            <button onclick="if(window.addRichTokens) { window.addRichTokens(); }" class="btn-dev-item">💰 돈복사</button>
        </div>
    </div>

    <div id="commentOverlay" class="sheet-overlay">
        <div class="comment-modal">
            <h3>💬 한줄평</h3>
            <p id="commentTargetName">...</p>
            <textarea id="commentInput" placeholder="내용 입력 (30자)" maxlength="30"></textarea>
            <div class="modal-btn-row">
                <button class="btn btn-outline" onclick="closeCommentPopup()">취소</button>
                <button class="btn btn-primary" onclick="submitComment()">보내기</button>
            </div>
        </div>
    </div>

    <div id="screen-login" class="screen active full-center">
        <div style="text-align:center;">
            <div style="font-size: 60px; margin-bottom: 20px;">🧐</div>
            <h1>It's me!</h1>
            <p>남들이 보는 진짜 나,<br>3초 만에 확인해보세요.</p>
        </div>
        <div style="width:100%; padding:20px;">
            <button class="btn btn-kakao" onclick="loginWithServer()">카카오로 시작하기</button>
            <button class="btn btn-outline" onclick="loginWithServer()">이메일로 시작하기</button>
            <div style="margin-top: 30px; border-top: 1px dashed #ccc; padding-top: 20px; text-align: center;">
                <p style="font-size: 12px; margin-bottom: 10px;">🚧 개발자 테스트</p>
                <div style="display: flex; gap: 10px; justify-content: center;">
                    <button class="btn" style="width:auto; padding:10px; font-size:12px; background:#2d3436; color:white;" onclick="debugLogin('user_test_a')">🦊 A</button>
                    <button class="btn" style="width:auto; padding:10px; font-size:12px; background:#636e72; color:white;" onclick="debugLogin('user_test_b')">🐰 B</button>
                </div>
            </div>
        </div>
    </div>

    <div id="screen-mbti" class="screen">
        <div class="scroll-body" style="padding:20px;">
            <div style="height: 20px;"></div>
            <h2>기초 데이터 입력</h2>
            <div class="mbti-grid">
                <button class="mbti-btn" onclick="saveMbtiToServer('ENFP')">ENFP</button><button class="mbti-btn" onclick="saveMbtiToServer('ISTJ')">ISTJ</button><button class="mbti-btn" onclick="saveMbtiToServer('ENTP')">ENTP</button><button class="mbti-btn" onclick="saveMbtiToServer('INFJ')">INFJ</button>
                <button class="mbti-btn" onclick="saveMbtiToServer('ISTP')">ISTP</button><button class="mbti-btn" onclick="saveMbtiToServer('ISFP')">ISFP</button><button class="mbti-btn" onclick="saveMbtiToServer('INFP')">INFP</button><button class="mbti-btn" onclick="saveMbtiToServer('INTP')">INTP</button>
                <button class="mbti-btn" onclick="saveMbtiToServer('ESTP')">ESTP</button><button class="mbti-btn" onclick="saveMbtiToServer('ESFP')">ESFP</button><button class="mbti-btn" onclick="saveMbtiToServer('ESTJ')">ESTJ</button><button class="mbti-btn" onclick="saveMbtiToServer('ESFJ')">ESFJ</button>
                <button class="mbti-btn" onclick="saveMbtiToServer('ENFJ')">ENFJ</button><button class="mbti-btn" onclick="saveMbtiToServer('ENTJ')">ENTJ</button><button class="mbti-btn" onclick="saveMbtiToServer('INTJ')">INTJ</button><button class="mbti-btn" onclick="saveMbtiToServer('ISFJ')">ISFJ</button>
            </div>
            <button class="btn btn-primary" onclick="goScreen('screen-test-1')">🤔 테스트 시작</button>
        </div>
    </div>

    <div id="screen-test-1" class="screen full-center"><div style="padding:20px; text-align:center;"><h3>Q1. 불금이다!<br>친구들이 부르면?</h3><button class="btn btn-outline" onclick="nextTest('E', 'screen-test-2')">오예! 당장 나간다! (E)</button><button class="btn btn-outline" onclick="nextTest('I', 'screen-test-2')">기 빨려... 집이 최고야. (I)</button></div></div>
    <div id="screen-test-2" class="screen full-center"><div style="padding:20px; text-align:center;"><h3>Q2. 멍 때릴 때<br>무슨 생각해?</h3><button class="btn btn-outline" onclick="nextTest('S', 'screen-test-3')">배고파... 저녁 뭐 먹지? (S)</button><button class="btn btn-outline" onclick="nextTest('N', 'screen-test-3')">좀비가 나타나면 어떡하지? (N)</button></div></div>
    <div id="screen-test-3" class="screen full-center"><div style="padding:20px; text-align:center;"><h3>Q3. 친구가 우울해서<br>화분 샀다고 하면?</h3><button class="btn btn-outline" onclick="nextTest('T', 'screen-test-4')">무슨 화분 샀어? 얼마야? (T)</button><button class="btn btn-outline" onclick="nextTest('F', 'screen-test-4')">헐... 무슨 일 있어? ㅠㅠ (F)</button></div></div>
    <div id="screen-test-4" class="screen full-center"><div style="padding:20px; text-align:center;"><h3>Q4. 여행 갈 때<br>계획은?</h3><button class="btn btn-outline" onclick="finishTest('J')">엑셀 켜고 분 단위 일정표 (J)</button><button class="btn btn-outline" onclick="finishTest('P')">여권만 챙겨서 출발! (P)</button></div></div>
    <div id="screen-nickname" class="screen full-center"><div style="padding:20px; text-align:center;"><h2>반가워요! 👋</h2><input type="text" id="inputNickname" placeholder="닉네임 입력" style="width:100%; padding:15px; margin-bottom:20px; border:2px solid #ddd; border-radius:10px;"><button class="btn btn-primary" onclick="saveNicknameAndNext()">다음으로</button></div></div>
    
    <div id="screen-main" class="screen">
        <div class="sticky-header-group">
            <div class="header-area">
                <h2 class="header-title">나의 거울</h2>
                <div class="header-badge">👑 상위 12% (종합)</div>
            </div>
            <div class="avatar-area" style="flex-direction:column; align-items:center;">
                <div class="avatar-circle">
                    <span id="myAvatar">👤</span>
                    <div class="avatar-badge" id="myMbtiBadge">#???</div>
                </div>
                <div id="myNicknameDisplay" style="font-size: 20px; font-weight: 800; margin-top: 10px; color: #2d3436;">닉네임</div>
                <div class="msg-bubble"><span id="mainMsg">"상태 메시지"</span></div>
            </div>
            <div class="sub-tab-bar">
                <div class="sub-tab active" onclick="goSubTab('tab-prism', this)">프리즘</div>
                <div class="sub-tab" onclick="goSubTab('tab-history', this)">발자취</div>
                <div class="sub-tab" onclick="goSubTab('tab-trophy', this)">업적</div>
            </div>
        </div>
        
        <div class="scroll-body no-scrollbar">
            <div id="tab-prism" class="sub-content active"><div class="chart-wrapper"><canvas id="myRadarChart"></canvas></div></div>
            <div id="tab-history" class="sub-content"><ul class="list-wrap"></ul></div>
            <div id="tab-trophy" class="sub-content"><div class="achieve-grid"></div></div>
        </div>
    </div>

    <div id="screen-vote" class="screen">
        <div id="voteHeader" class="sticky-header-group vote-header">
            <div style="text-align:center;">
                <span class="ticket-badge" id="ticketDisplay">🎫 남은 티켓: 5/5</span><br>
                <span class="round-badge" id="roundBadge">토너먼트 시작</span>
                <h3 id="voteTitle" style="margin-top:10px;">...</h3>
            </div>
        </div>
        <div class="scroll-body no-scrollbar" style="display:flex; flex-direction:column; justify-content:center;">
            <div class="vote-wrapper" id="voteWrapper">
                <div class="vs-container" id="vsContainer">
                    <div class="vs-card" onclick="vote(0)"><div class="vs-avatar" id="avatarA">❓</div><div class="vs-name" id="nameA">...</div><div class="vs-desc" id="descA">...</div></div>
                    <div class="vs-divider-text">VS</div>
                    <div class="vs-card" onclick="vote(1)"><div class="vs-avatar" id="avatarB">❓</div><div class="vs-name" id="nameB">...</div><div class="vs-desc" id="descB">...</div></div>
                </div>
            </div>
            <div id="winnerContainer" style="display:none; text-align:center;">
                <div class="winner-box">
                    <div class="winner-avatar" id="winnerAvatar">🏆</div> 
                    <h2 id="winnerTitle">우승!</h2> 
                    <h1 id="winnerName" style="color:var(--primary);">...</h1>
                    <p id="winnerText">점수 전달 완료!</p>
                </div>
            </div>
            <button class="btn" style="background:#f1f2f6; color:#a4b0be; margin-top:20px;" id="passBtn" onclick="startTournament()">🤔 잘 모르는 사람들이에요</button>
        </div>
    </div>
    
    <div id="screen-rank" class="screen">
        <div class="sticky-header-group">
            <div class="rank-header-area">
                <h2 style="margin-bottom:15px;">주변미터 랭킹</h2>
                <div class="rank-filter-row">
                    <div class="stat-pills">
                        <div class="stat-pill active" onclick="filterRank(this, -1)">📊 <span class="pill-text">종합</span></div>
                        <div class="stat-pill" onclick="filterRank(this, 0)">🧠 <span class="pill-text">지성</span></div>
                        <div class="stat-pill" onclick="filterRank(this, 1)">⚡ <span class="pill-text">센스</span></div>
                        <div class="stat-pill" onclick="filterRank(this, 2)">🛡️ <span class="pill-text">멘탈</span></div>
                        <div class="stat-pill" onclick="filterRank(this, 3)">💖 <span class="pill-text">인성</span></div>
                        <div class="stat-pill" onclick="filterRank(this, 4)">🎉 <span class="pill-text">텐션</span></div>
                        <div class="stat-pill" onclick="filterRank(this, 5)">🌀 <span class="pill-text">광기</span></div>
                        <div style="min-width: 30px; height: 10px; flex-shrink: 0;"></div>
                    </div>
                </div>
            </div>
        </div>
        <div class="scroll-body no-scrollbar">
            <ul class="list-wrap" id="rankListContainer"></ul>
        </div>
    </div>

    <div id="screen-shop" class="screen">
        <div class="sticky-header-group">
            <h2>상점</h2>
            <div style="font-weight:bold; color:var(--primary); margin-top:5px;">내 보유 토큰: <span id="shopTokenDisplay">0</span> 💎</div>
        </div>
        <div class="scroll-body no-scrollbar" style="padding-top:20px;">
            <div class="shop-section">
                <div class="shop-title">💎 토큰 충전소</div>
                <div class="shop-grid">
                    <div class="shop-item" onclick="alert('테스트용')"><div class="shop-item-img">💰</div><div class="shop-item-name">토큰 100개</div><div class="shop-item-price cash-price">₩ 1,200</div></div>
                    <div class="shop-item" onclick="alert('테스트용')"><div class="shop-item-img">💰</div><div class="shop-item-name">토큰 550개</div><div class="shop-item-price cash-price">₩ 5,900</div></div>
                </div>
            </div>
            <div class="shop-section">
                <div class="shop-title">🦊 아바타 스킨 (영구)</div>
                <div class="shop-grid">
                    <div class="shop-item" onclick="purchaseItem(50, 'avatar', '🐯', '호랑이')"><div class="shop-item-img">🐯</div><div class="shop-item-name">호랑이</div><div class="shop-item-price">💎 50</div></div>
                    <div class="shop-item" onclick="purchaseItem(50, 'avatar', '🐰', '토끼')"><div class="shop-item-img">🐰</div><div class="shop-item-name">토끼</div><div class="shop-item-price">💎 50</div></div>
                    <div class="shop-item" onclick="purchaseItem(100, 'avatar', '👽', '외계인')"><div class="shop-item-img">👽</div><div class="shop-item-name">외계인</div><div class="shop-item-price">💎 100</div></div>
                    <div class="shop-item" onclick="purchaseItem(100, 'avatar', '🤖', '로봇')"><div class="shop-item-img">🤖</div><div class="shop-item-name">로봇</div><div class="shop-item-price">💎 100</div></div>
                </div>
            </div>
            <div class="shop-section">
                <div class="shop-title">✨ 효과 아이템 (7일)</div>
                <div class="shop-grid">
                    <div class="shop-item" onclick="purchaseItem(30, 'effect', 'bg-gold', '황금 배경')"><div class="shop-item-img">✨</div><div class="shop-item-name">황금 배경</div><div class="shop-item-price">💎 30</div></div>
                    <div class="shop-item" onclick="purchaseItem(30, 'effect', 'bg-dark', '다크 모드')"><div class="shop-item-img">🌑</div><div class="shop-item-name">다크 모드</div><div class="shop-item-price">💎 30</div></div>
                </div>
            </div>
        </div>
    </div>

    <div id="screen-settings" class="screen">
        <div class="sticky-header-group">
            <h2 style="text-align:center; margin-bottom:20px;">설정</h2>
            <div class="settings-profile">
                <div class="st-avatar" id="settingsAvatar">👤</div>
                <div class="st-info"><div class="st-name" id="settingsNickname">나</div><div class="st-account">kakao_u***</div></div>
            </div>
        </div>
        <div class="scroll-body no-scrollbar" style="padding-top:20px;">
            <div class="settings-msg-box">
                <span class="st-msg-label">나의 한마디</span>
                <div class="st-msg-text" id="settingMsg">"..."</div>
                <div class="st-msg-edit" onclick="editProfileMsg()">✏️</div>
            </div>
            <ul class="settings-menu">
                <li class="st-menu-item" onclick="openInventory()"><span>🎒 내 아이템 보관함</span><span style="color: var(--primary); font-weight:bold;">열기 ></span></li>
                <li class="st-menu-item"><span>🔔 알림 설정</span><span style="color: #ccc;">></span></li>
                <li class="st-menu-item"><span>📜 이용 약관</span><span style="color: #ccc;">></span></li>
            </ul>
            <button class="btn" style="background:#eee; color:#ff4757;" onclick="logout()">로그아웃</button>
        </div>
    </div>

    <div id="bottomSheetOverlay" class="sheet-overlay" onclick="closeSheet()">
        <div class="bottom-sheet" onclick="event.stopPropagation()"></div>
    </div>
    
    <div class="bottom-nav">
        <div class="nav-item active" onclick="goTab('screen-main', this)"><span class="nav-icon">🪞</span>거울</div>
        <div class="nav-item" onclick="goTab('screen-vote', this)"><span class="nav-icon">⚖️</span>평가</div>
        <div class="nav-item" onclick="goTab('screen-rank', this)"><span class="nav-icon">🏆</span>랭킹</div>
        <div class="nav-item" onclick="goTab('screen-shop', this)"><span class="nav-icon">🛍️</span>상점</div>
        <div class="nav-item" onclick="goTab('screen-settings', this)"><span class="nav-icon">⚙️</span>설정</div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
<script src="logic.js?v=31.0"></script>
<script src="ui.js?v=20.0"></script>
<script src="init_test.js"></script>   
</body>
</html>